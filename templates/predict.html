{% extends "base.html" %}

{% block title %}Predict Performance{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: #e6f7ff;
        min-height: 100vh;
    }
    
    .main-heading {
        text-align: center;
        margin: 2rem 0;
        color: #1a237e;
        position: relative;
        padding-bottom: 1rem;
    }
    
    .main-heading h2 {
        font-weight: 700;
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .main-heading::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100px;
        height: 4px;
        background: linear-gradient(135deg, #1a75ff, #003399);
        border-radius: 2px;
    }
    
    .card {
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        border-radius: 16px;
        margin-bottom: 30px;
        border: none;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .prediction-card {
        display: none;
        animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
    }
    
    .card-header {
        background: linear-gradient(135deg, #1a75ff, #003399);
        color: white;
        border-top-left-radius: 16px !important;
        border-top-right-radius: 16px !important;
        padding: 1.5rem;
    }
    
    .card-header h5 {
        margin-bottom: 0;
        font-weight: 600;
        font-size: 1.25rem;
        letter-spacing: 0.5px;
    }
    
    .card-body {
        padding: 2rem;
    }

    .form-label {
        font-weight: 500;
        color: #2c3e50;
        margin-bottom: 0.5rem;
    }

    .form-control, .form-select {
        border-radius: 8px;
        border: 2px solid #e9ecef;
        padding: 0.75rem;
        transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        border-color: #1a75ff;
        box-shadow: 0 0 0 0.2rem rgba(26, 117, 255, 0.15);
    }

    .btn-primary {
        background: linear-gradient(135deg, #1a75ff, #003399);
        border: none;
        border-radius: 8px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 4px 15px rgba(0, 50, 153, 0.3);
        transition: all 0.3s ease;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 50, 153, 0.4);
    }

    .prediction-score {
        font-size: 3rem;
        font-weight: 700;
        color: #1a75ff;
        text-align: center;
        margin: 1.5rem 0;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }

    .prediction-category {
        text-align: center;
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 2rem;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        background: rgba(26, 117, 255, 0.1);
        color: #1a75ff;
    }

    .factors-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .factor-item {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
        padding: 1rem;
        background: #f8f9fa;
        border-radius: 8px;
        transition: transform 0.2s ease;
    }

    .factor-item:hover {
        transform: translateX(5px);
    }

    .factor-icon {
        width: 40px;
        height: 40px;
        background: #1a75ff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        color: white;
        font-size: 1.2rem;
    }

    .suggestions {
        background: #e8f5e9;
        border-radius: 8px;
        padding: 1.5rem;
        margin-top: 2rem;
    }

    .suggestions h6 {
        color: #2e7d32;
        margin-bottom: 1rem;
    }

    .suggestion-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1rem;
    }

    .suggestion-item:before {
        content: 'âœ“';
        color: #2e7d32;
        margin-right: 0.5rem;
    }

    @media (max-width: 768px) {
        .card-body {
            padding: 1.5rem;
        }

        .prediction-score {
            font-size: 2.5rem;
        }

        .prediction-category {
            font-size: 1.25rem;
        }
    }

    /* Loading animation */
    .loading {
        display: none;
        text-align: center;
        padding: 2rem;
    }

    .loading-spinner {
        width: 50px;
        height: 50px;
        border: 5px solid #f3f3f3;
        border-top: 5px solid #1a75ff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .section {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        background-color: #f8f9fa;
    }

    .section h4 {
        color: #0d6efd;
        font-weight: 600;
    }

    .form-control:focus, .form-select:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }

    .btn-primary {
        padding: 10px 30px;
        font-weight: 500;
    }

    .section-header {
        background: #f8f9fa;
        padding: 1rem;
        margin: 1.5rem -2rem;
        border-left: 4px solid #1a75ff;
        font-weight: 600;
        color: #2c3e50;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="main-heading">
    <h2>Student Performance Prediction</h2>
    <p class="text-muted">Enter student details to predict academic performance</p>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-chart-line me-2"></i>Performance Prediction Form</h5>
                </div>
                <div class="card-body">
                    <form id="predictionForm" method="POST">
                        <!-- Academic Metrics -->
                        <div class="section-header">
                            <i class="fas fa-book me-2"></i>Academic Metrics
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Study Hours/Day</label>
                                    <input type="number" class="form-control" name="study_hours" min="0" max="24" step="0.5" required
                                           value="{{ student_data.study_hours if student_data }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Study Environment</label>
                                    <select class="form-select" name="study_environment" required>
                                        <option value="">Select Environment</option>
                                        <option value="Quiet" {% if student_data and student_data.study_environment == 'Quiet' %}selected{% endif %}>Quiet</option>
                                        <option value="Moderate" {% if student_data and student_data.study_environment == 'Moderate' %}selected{% endif %}>Moderate</option>
                                        <option value="Noisy" {% if student_data and student_data.study_environment == 'Noisy' %}selected{% endif %}>Noisy</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Attendance (%)</label>
                                    <input type="number" class="form-control" name="attendance" min="0" max="100" required
                                           value="{{ student_data.attendance if student_data }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Previous Grades</label>
                                    <input type="number" class="form-control" name="previous_grades" min="0" max="100" required
                                           value="{{ student_data.previous_grades if student_data }}">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Participation Score (0-10)</label>
                                    <input type="number" class="form-control" name="participation_score" min="0" max="10" required
                                           value="{{ student_data.participation_score if student_data }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Assignment Submission Timeliness</label>
                                    <select class="form-select" name="assignment_timeliness" required>
                                        <option value="">Select Timeliness</option>
                                        <option value="always_on_time" {% if student_data and student_data.assignment_timeliness == 'always_on_time' %}selected{% endif %}>Always on Time</option>
                                        <option value="sometimes_late" {% if student_data and student_data.assignment_timeliness == 'sometimes_late' %}selected{% endif %}>Sometimes Late</option>
                                        <option value="often_late" {% if student_data and student_data.assignment_timeliness == 'often_late' %}selected{% endif %}>Often Late</option>
                                        <option value="never" {% if student_data and student_data.assignment_timeliness == 'never' %}selected{% endif %}>Never</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Parental Involvement -->
                        <div class="section-header">
                            <i class="fas fa-users me-2"></i>Parental Involvement
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Parent-Teacher Meeting Frequency</label>
                                    <select class="form-select" name="parent_meeting_freq" required>
                                        <option value="">Select Frequency</option>
                                        <option value="Frequently" {% if student_data and student_data.parent_meeting_freq == 'Frequently' %}selected{% endif %}>Frequently</option>
                                        <option value="Sometimes" {% if student_data and student_data.parent_meeting_freq == 'Sometimes' %}selected{% endif %}>Sometimes</option>
                                        <option value="Rarely" {% if student_data and student_data.parent_meeting_freq == 'Rarely' %}selected{% endif %}>Rarely</option>
                                        <option value="Never" {% if student_data and student_data.parent_meeting_freq == 'Never' %}selected{% endif %}>Never</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Home Support for Learning</label>
                                    <select class="form-select" name="home_support" required>
                                        <option value="">Select Support Level</option>
                                        <option value="High" {% if student_data and student_data.home_support == 'High' %}selected{% endif %}>High</option>
                                        <option value="Moderate" {% if student_data and student_data.home_support == 'Moderate' %}selected{% endif %}>Moderate</option>
                                        <option value="Low" {% if student_data and student_data.home_support == 'Low' %}selected{% endif %}>Low</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Psychological & Lifestyle Factors -->
                        <div class="section-header">
                            <i class="fas fa-brain me-2"></i>Psychological & Lifestyle Factors
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Sleep Duration (hours/day)</label>
                                    <input type="number" class="form-control" name="sleep_duration" min="0" max="24" step="0.5" required
                                           value="{{ student_data.sleep_duration if student_data }}">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Stress Level (0-10)</label>
                                    <input type="number" class="form-control" name="stress_level" min="0" max="10" required
                                           value="{{ student_data.stress_level if student_data }}">
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <div class="form-group">
                                    <label class="form-label">Physical Activity (hours/week)</label>
                                    <input type="number" class="form-control" name="physical_activity" min="0" max="168" step="0.5" required
                                           value="{{ student_data.physical_activity if student_data }}">
                                </div>
                            </div>
                        </div>

                        <!-- Peer Influence and Socio-economic Factors -->
                        <div class="section-header">
                            <i class="fas fa-user-friends me-2"></i>Peer Influence and Socio-economic Factors
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Peer Group Academic Quality</label>
                                    <select class="form-select" name="peer_academic_quality" required>
                                        <option value="">Select Quality</option>
                                        <option value="Excellent" {% if student_data and student_data.peer_academic_quality == 'Excellent' %}selected{% endif %}>Excellent</option>
                                        <option value="Good" {% if student_data and student_data.peer_academic_quality == 'Good' %}selected{% endif %}>Good</option>
                                        <option value="Average" {% if student_data and student_data.peer_academic_quality == 'Average' %}selected{% endif %}>Average</option>
                                        <option value="Poor" {% if student_data and student_data.peer_academic_quality == 'Poor' %}selected{% endif %}>Poor</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label class="form-label">Socio-economic Status</label>
                                    <select class="form-select" name="socio_economic_status" required>
                                        <option value="">Select Status</option>
                                        <option value="High" {% if student_data and student_data.socio_economic_status == 'High' %}selected{% endif %}>High</option>
                                        <option value="Middle" {% if student_data and student_data.socio_economic_status == 'Middle' %}selected{% endif %}>Middle</option>
                                        <option value="Low" {% if student_data and student_data.socio_economic_status == 'Low' %}selected{% endif %}>Low</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-calculator me-2"></i>Predict Performance
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            {% if prediction %}
            <div class="card prediction-card" style="display: block;">
                <div class="card-header">
                    <h5><i class="fas fa-chart-bar me-2"></i>Prediction Results</h5>
                </div>
                <div class="card-body">
                    <div class="prediction-score">{{ prediction.prediction }}%</div>
                    <div class="suggestions">
                        <h6><i class="fas fa-lightbulb me-2"></i>Suggestions for Improvement</h6>
                        <ul class="list-unstyled">
                            {% for suggestion in prediction.suggestions %}
                            <li class="suggestion-item">{{ suggestion }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('predictionForm');
    
    form.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(form);
        
        fetch('/predict', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            location.reload();
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error making prediction');
        });
    });
});
</script>
{% endblock %} 